{% extends "base.html" %}

{% block title %}AI Code Scanner - Security Vulnerability Detection{% endblock %}

{% block content %}
<div class="main-container">
    <div class="chat-container">
        <div class="chat-header">
            <h1 class="chat-title">
                <i class="fas fa-shield-alt"></i> AI Code Scanner
            </h1>
            <p class="chat-subtitle">Analyze code and logs for security vulnerabilities using AI</p>
        </div>

        <div class="input-section">
            <div class="input-tabs">
                <button class="tab-button active" data-tab="code-tab">
                    <i class="fas fa-code"></i> Code Analysis
                </button>
                <button class="tab-button" data-tab="upload-tab">
                    <i class="fas fa-file-upload"></i> File Upload
                </button>
                <button class="tab-button" data-tab="log-tab">
                    <i class="fas fa-clipboard-list"></i> Log Analysis
                </button>
            </div>

            <!-- Code Analysis Tab -->
            <div id="code-tab" class="tab-content active">
                <form method="POST" action="{{ url_for('scan_code') }}" id="codeForm">
                    <textarea class="code-input" id="code" name="code"
                        placeholder="Paste your code here for security analysis...&#10;&#10;Supports: Python, JavaScript, Java, PHP, C#, C++, SQL, HTML, and more"></textarea>
                    <div class="submit-section">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-search"></i> Analyze Code
                        </button>
                        <button type="button" class="btn-secondary"
                            onclick="document.getElementById('code').value = ''">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </form>
            </div>

            <!-- File Upload Tab -->
            <div id="upload-tab" class="tab-content">
                <form method="POST" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" id="uploadForm">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">
                            Drop your file here or click to browse
                        </div>
                        <div class="file-info">
                            Supported formats: .py, .js, .java, .php, .cs, .cpp, .html, .sql, .log, .txt
                        </div>
                        <input type="file" class="file-input" id="file" name="file"
                            accept=".py,.js,.jsx,.ts,.tsx,.java,.php,.rb,.go,.cs,.cpp,.c,.h,.hpp,.sql,.html,.xml,.json,.yaml,.yml,.sh,.bash,.ps1,.jsp,.asp,.aspx,.log,.txt">
                    </div>
                    <div class="submit-section">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-upload"></i> Upload & Analyze
                        </button>
                        <button type="button" class="btn-secondary" onclick="clearFile()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </form>
            </div>

            <!-- Log Analysis Tab -->
            <div id="log-tab" class="tab-content">
                <form method="POST" action="{{ url_for('analyze_logs') }}" id="logForm">
                    <textarea class="code-input" id="logContent" name="logContent"
                        placeholder="Paste your log files here for security analysis...&#10;&#10;Supports: Apache, Nginx, Windows Event Logs, Application Logs, System Logs, Custom Logs"></textarea>
                    <div class="log-types">
                        <span class="log-type-badge">Apache Access/Error</span>
                        <span class="log-type-badge">Nginx Logs</span>
                        <span class="log-type-badge">Windows Event</span>
                        <span class="log-type-badge">Application Logs</span>
                        <span class="log-type-badge">System Logs</span>
                        <span class="log-type-badge">Custom Logs</span>
                    </div>
                    <div class="submit-section">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-search"></i> Analyze Logs
                        </button>
                        <button type="button" class="btn-secondary"
                            onclick="document.getElementById('logContent').value = ''">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="capabilities-section">
            <h3 class="capabilities-title">
                <i class="fas fa-shield-alt"></i> Security Analysis Capabilities
            </h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A01:2021 – Broken Access Control</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A02:2021 – Cryptographic Failures</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A03:2021 – Injection Attacks</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A04:2021 – Insecure Design</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A05:2021 – Security Misconfiguration</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A06:2021 – Vulnerable Components</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A07:2021 – Authentication Failures</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A08:2021 – Data Integrity Failures</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A09:2021 – Logging & Monitoring</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>A10:2021 – Server-Side Request Forgery</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-analysis-section">
            <h3 class="log-analysis-title">
                <i class="fas fa-clipboard-list"></i> Log Analysis Features
            </h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>Failed Login Attempts Detection</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>Brute Force Attack Patterns</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>Suspicious IP Activity</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>SQL Injection Attempts</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>Anomalous Traffic Patterns</span>
                    </div>
                    <div class="capability-item">
                        <i class="fas fa-check-circle capability-icon"></i>
                        <span>Error Pattern Analysis</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loadingDiv">
            <div class="spinner"></div>
            <h5>Analyzing your input for security vulnerabilities...</h5>
            <p style="color: var(--text-secondary)">This may take a few moments</p>
        </div>
    </div>
</div>

<script>
    // Tab switching functionality
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.dataset.tab;

            // Remove active class from all buttons and content
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to clicked button and corresponding content
            button.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });

    // File upload functionality
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('file');

    uploadArea.addEventListener('click', () => {
        fileInput.click();
    });

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            updateUploadArea(files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            updateUploadArea(e.target.files[0]);
        }
    });

    function updateUploadArea(file) {
        const uploadIcon = uploadArea.querySelector('.upload-icon');
        const uploadText = uploadArea.querySelector('.upload-text');
        const fileInfo = uploadArea.querySelector('.file-info');

        uploadIcon.innerHTML = '<i class="fas fa-file-alt"></i>';
        uploadText.textContent = file.name;
        fileInfo.textContent = `Size: ${(file.size / 1024).toFixed(2)} KB`;
    }

    function clearFile() {
        const fileInput = document.getElementById('file');
        const uploadArea = document.getElementById('uploadArea');

        fileInput.value = '';

        uploadArea.querySelector('.upload-icon').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
        uploadArea.querySelector('.upload-text').textContent = 'Drop your file here or click to browse';
        uploadArea.querySelector('.file-info').textContent = 'Supported formats: .py, .js, .java, .php, .cs, .cpp, .html, .sql, .log, .txt';
    }

    // Loading animation
    document.getElementById('codeForm').addEventListener('submit', () => {
        document.getElementById('loadingDiv').style.display = 'block';
    });

    document.getElementById('uploadForm').addEventListener('submit', () => {
        document.getElementById('loadingDiv').style.display = 'block';
    });

    document.getElementById('logForm').addEventListener('submit', () => {
        document.getElementById('loadingDiv').style.display = 'block';
    });
</script>
{% endblock %}